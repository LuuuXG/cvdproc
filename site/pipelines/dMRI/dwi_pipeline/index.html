
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../sMRI/pvs_quantification/">
      
      
        <link rel="next" href="../lqt_pipeline/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>DWI Preprocessing and Analysis - cvdproc</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dwi-pipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="cvdproc" class="md-header__button md-logo" aria-label="cvdproc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            cvdproc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DWI Preprocessing and Analysis
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="cvdproc" class="md-nav__button md-logo" aria-label="cvdproc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    cvdproc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Dicom2BIDS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Dicom2BIDS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dcm2bids/dcm2bids/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dcm2bids
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pipelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Structural MRI (sMRI) Pipelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Structural MRI (sMRI) Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sMRI/lesion_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesion Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sMRI/t1_register/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T1w Registration to MNI space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sMRI/freesurfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Freesurfer Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sMRI/anat_seg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anatomical Segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sMRI/wmh_quantification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WMH Quantification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sMRI/pvs_quantification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PVS Quantification
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Diffusion MRI (dMRI) Pipelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Diffusion MRI (dMRI) Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    DWI Preprocessing and Analysis
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    DWI Preprocessing and Analysis
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cvdproc.pipelines.dmri.dwi_pipeline.DWIPipeline.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvdproc.pipelines.dmri.dwi_pipeline.DWIPipeline.check_data_requirements" class="md-nav__link">
    <span class="md-ellipsis">
      check_data_requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-more-detailed-description" class="md-nav__link">
    <span class="md-ellipsis">
      A more detailed description:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A more detailed description:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dwi-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      DWI Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DWI Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-shell-and-multi-shell-dwi-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Single-shell and Multi-shell DWI preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      DSI preprocessing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconstruction-of-diffusion-models" class="md-nav__link">
    <span class="md-ellipsis">
      Reconstruction of Diffusion Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconstruction of Diffusion Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tensor-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      Tensor Model Fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#free-water-elimination-dti-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      Free Water Elimination DTI Model Fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noddi-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      NODDI Model Fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      DSI Model Fitting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anatomical-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Anatomical Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anatomical Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registration-between-dwi-and-anatomiocal-images-fsnative-and-t1w-space" class="md-nav__link">
    <span class="md-ellipsis">
      Registration between DWI and anatomiocal Images (fsnative and T1w space)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dwi-derived-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      DWI-derived Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DWI-derived Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#psmd" class="md-nav__link">
    <span class="md-ellipsis">
      PSMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dti-alps" class="md-nav__link">
    <span class="md-ellipsis">
      DTI-ALPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pved" class="md-nav__link">
    <span class="md-ellipsis">
      PVeD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connectome-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Connectome Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connectome Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mrtrix3-based-connectome-construction" class="md-nav__link">
    <span class="md-ellipsis">
      MRtrix3-based Connectome Construction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lqt_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesion Quantification Toolkit (LQT)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Quantification MRI (qMRI) Pipelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Quantification MRI (qMRI) Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qMRI/qsm_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QSM Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qMRI/sepia_qsm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sepia QSM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Perfusion MRI (PWI) Pipelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Perfusion MRI (PWI) Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwi/pwi_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PWI Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Containers Used
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../publications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publications
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cvdproc.pipelines.dmri.dwi_pipeline.DWIPipeline.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvdproc.pipelines.dmri.dwi_pipeline.DWIPipeline.check_data_requirements" class="md-nav__link">
    <span class="md-ellipsis">
      check_data_requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-more-detailed-description" class="md-nav__link">
    <span class="md-ellipsis">
      A more detailed description:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A more detailed description:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dwi-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      DWI Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DWI Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-shell-and-multi-shell-dwi-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Single-shell and Multi-shell DWI preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      DSI preprocessing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconstruction-of-diffusion-models" class="md-nav__link">
    <span class="md-ellipsis">
      Reconstruction of Diffusion Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconstruction of Diffusion Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tensor-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      Tensor Model Fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#free-water-elimination-dti-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      Free Water Elimination DTI Model Fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noddi-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      NODDI Model Fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dsi-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      DSI Model Fitting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anatomical-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Anatomical Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anatomical Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registration-between-dwi-and-anatomiocal-images-fsnative-and-t1w-space" class="md-nav__link">
    <span class="md-ellipsis">
      Registration between DWI and anatomiocal Images (fsnative and T1w space)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dwi-derived-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      DWI-derived Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DWI-derived Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#psmd" class="md-nav__link">
    <span class="md-ellipsis">
      PSMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dti-alps" class="md-nav__link">
    <span class="md-ellipsis">
      DTI-ALPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pved" class="md-nav__link">
    <span class="md-ellipsis">
      PVeD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connectome-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Connectome Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connectome Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mrtrix3-based-connectome-construction" class="md-nav__link">
    <span class="md-ellipsis">
      MRtrix3-based Connectome Construction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="dwi-pipeline">DWI Pipeline</h1>


<div class="doc doc-object doc-class">




    <div class="doc doc-contents first">











  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="cvdproc.pipelines.dmri.dwi_pipeline.DWIPipeline.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>DWI pipeline</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>subject</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Subject object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_which_dwi</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which DWI file to use. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_which_t1w</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which T1w file to use. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_which_flair</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which FLAIR file to use. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>preprocess</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to preprocess the DWI data. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output resolution in mm. Defaults to 2.0.</p>
              </div>
            </td>
            <td>
                  <code>2.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>degibbs</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to perform degibbsing. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_b_table_axis</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of axes to flip the b-table. Defaults to []. [0], [1], [2] for x, y, z axes.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>preprocess_method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessing method. 'fdt', 'mrtrix3' or 'post_qsiprep'. Defaults to 'fdt'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;fdt&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>synb0</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use Synb0 for TOPUP. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_which_reverse_b0</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which reverse coded b0 image to use. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dti_fit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fit DTI model using FSL dtifit. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dwi_t1w_register</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to register DWI to T1w space. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dsistudio_gqi</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fit GQI model using DSI Studio. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dsistudio_qsdr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fit QSDR model using DSI Studio. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>amico_noddi</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fit NODDI model using AMICO. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>connectome</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create a connectome (Global). Defaults to []. Subsets of ['fdt', 'mrtrix3', 'dsistudio'].</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tractography</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tractography method (ROI-based). Defaults to []. Subsets of ['fdt', 'mrtrix3', 'dsistudio'].</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed_mask</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder name for seed mask. Expected to find <bids_dir>/derivatives/<seed_mask>/sub-<id>/ses-<id>/<em><use_which_mask></em>.nii.gz. Defaults to 'lesion_mask'. Must be in the T1w space.</p>
              </div>
            </td>
            <td>
                  <code>&#39;lesion_mask&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_which_mask</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which mask file to use (in the processed DWI space). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtialps</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to perform DTI-ALPS analysis. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtialps_register_method</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Registration method for DTI-ALPS. 1 for FA + FLIRT, 2 for FA + synthmorph.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pved</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to perform PVeD analysis. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>freewater</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of freewater estimation methods. Defaults to []. Subsets of ['single_shell_freewater', 'markvcid_freewater', 'dti_freewater'].</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psmd</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to perform PSMD analysis. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psmd_exclude_seed_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to exclude seed mask in PSMD calculation. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>visual_pathway_analysis</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to perform visual pathway analysis. Defaults to False. (An ongoing project! Experimental feature.)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>calculate_dwi_metrics</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to calculate DWI scalar maps. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_seed_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to exclude seed mask in DWI metrics calculation (For NAWM). Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_wmh_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to exclude WMH mask in DWI metrics calculation (For NAWM). Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extract_from</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder name to extract results from.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvdproc.pipelines.dmri.dwi_pipeline.DWIPipeline.check_data_requirements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_data_requirements</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>check if the required data is available
:return: bool</p>


    </div>

</div>



  </div>

    </div>

</div><hr />
<h2 id="a-more-detailed-description">A more detailed description:</h2>
<h3 id="dwi-preprocessing">DWI Preprocessing</h3>
<h4 id="single-shell-and-multi-shell-dwi-preprocessing">Single-shell and Multi-shell DWI preprocessing</h4>
<p>We use customized scripts to preprocess single-shell and multi-shell DWI data, because current popular DWI preprocessing tools (e.g., <a href="https://www.mrtrix.org/">MRtrix3</a>, <a href="https://qsiprep.readthedocs.io/en/latest/index.html">QSIPrep</a>) do not provide an easy way to use <a href="https://github.com/MASILab/Synb0-DISCO">Synb0-DISCO</a> for distortion correction when no field map is available.</p>
<p>The main steps of our DWI preprocessing pipeline are as follows:</p>
<ol>
<li>If no reverse phase-encoding (PE) b0 image is available, we use Synb0-DISCO to synthesize the undistorted b0 image from T1w image. Otherwise, we directly use the reverse PE b0 image.</li>
<li>Denoise and Gibbs ringing removal (Gibbs ringing removal can be optionally applied).</li>
<li>FSL's TOPUP and EDDY for distortion and motion correction, using the real or synthesized reverse PE b0 image.</li>
<li>Resample the DWI data to a isotropic voxel size.</li>
</ol>
<h4 id="dsi-preprocessing">DSI preprocessing</h4>
<p>We use <a href="https://qsiprep.readthedocs.io/en/latest/index.html">QSIPrep</a> for DSI preprocessing. Our DWI Pipeline starts from QSIPrep preprocessed DSI data for further analysis. TOPUP and EDDY-based distortion and motion correction are not suitable for q-space sampling schemes like DSI, this is the reason why we do not employ <a href="https://dsi-studio.labsolver.org/doc/">DSIStudio</a> for DSI preprocessing.</p>
<p>Concerning the DSI preprocessing pipeline implemented in QSIPrep is time-consuming (e.g., <a href="https://neurostars.org/t/very-long-running-time-qsiprep-processing-dsi-data/28972">Very long running time qsiprep processing DSI data</a>), we make some modifications to speed up the process (by running the script <a href="../../../cvdproc/pipelines/bash/qsiprep_qsirecon/qsiprep_single.sh">qsiprep_single.sh</a>):</p>
<ol>
<li>Use <code>DRBUDDI_cuda</code> rather than <code>DRBUDDI</code> for distortion correction. Note that <code>DRBUDDI_cuda</code> requires a CUDA-capable GPU. Another change is to set <code>--DRBUDDI_disable_initial_rigid</code> flag to skip the initial rigid registration for a more stable run on PC.</li>
<li>Set <code>shoreline-iters</code> to <code>1</code></li>
<li>Skip ANTs-based spatial normalization to MNI space by setting <code>--skip-anat-based-spatial-normalization</code> flag. To generate non-linear spatial warps to MNI space (needed for downstream QSIRecon processing), we run a separate registration using <a href="https://martinos.org/malte/synthmorph/">mri_synthmorph</a> implemented in Freesurfer 7-dev version.</li>
<li>Only use T1w image as anatomical reference. This is ensured by excluding T2w and T2 FLAIR images with nipreps' <code>qsiprep_filter.json</code> file (see <a href="https://fmriprep.org/en/latest/faq.html#how-do-i-select-only-certain-files-to-be-input-to-fmriprep">How do I select only certain files to be input to fMRIPrep?</a>).</li>
</ol>
<p>For Chinese readers, notes on using QSIPrep for DSI preprocessing can be found <a href="https://neuroimaging-notes-of-lxg.readthedocs.io/zh/latest/dMRI/qsiprep2.html">here</a>.</p>
<p>If you are interested in replicating our DSI preprocessing pipeline: please first modify QSIPrep's docker file by using a new <a href="../../../cvdproc/utils/python/tortoise.py">tortoise.py</a>, then you can reference the script (<a href="../../../cvdproc/pipelines/bash/qsiprep_qsirecon/qsiprep_single.sh">qsiprep_single.sh</a>) to run QSIPrep for DSI preprocessing (DWI and reverse b0 images in BIDS format, and put Freesurfer <code>license.txt</code>, <code>DRBUDDI_cuda.sh</code> <a href="../../../cvdproc/pipelines/bash/qsiprep_qsirecon/DRBUDDI_cuda.sh">wrapper script</a>, and <code>qsiprep_filter.json</code> in a folder named <code>code</code> in BIDS root directory). </p>
<h3 id="reconstruction-of-diffusion-models">Reconstruction of Diffusion Models</h3>
<h4 id="tensor-model-fitting">Tensor Model Fitting</h4>
<p>FSL FDT <code>dtifit</code> is used to fit the diffusion tensor model and calculate DTI-derived metrics, including FA, MD, AD, RD, and tensor mode.</p>
<h4 id="free-water-elimination-dti-model-fitting">Free Water Elimination DTI Model Fitting</h4>
<p>Three available options:
- Set 'markvcid_freewater' in <code>freewater</code> (<strong>Recommended</strong>): <a href="https://markvcid.partners.org/sites/default/files/markvcid2/protocols/MarkVCID_FW_Kit_Protocol_v6.12.23.pdf">MarkVCID2 MRI Free Water (FW)</a>. As it has been validated on MarkVCID2 study <sup id="fnref:maillard2022mri"><a class="footnote-ref" href="#fn:maillard2022mri">1</a></sup> and external datasets <sup id="fnref:lin2025longitudinal"><a class="footnote-ref" href="#fn:lin2025longitudinal">2</a></sup>.</p>
<ul>
<li>
<p>Set 'single_shell_freewater' in <code>freewater</code>: <a href="https://github.com/sameerd/DiffusionTensorImaging">Single Shell Free Water Elimination Diffusion Tensor Model</a></p>
</li>
<li>
<p>Set 'dti_freewater' in <code>freewater</code>: <a href="https://docs.dipy.org/stable/examples_built/reconstruction/reconst_fwdti.html">DIPY free water elimination model</a>. Multi-shell DWI data is required for this method. For our clinical analysis, we mainly focus on the free water component rather than the free water-corrected DTI metrics, this method is not that practical as multi-shell DWI can directly use NODDI model to characterize extracellular water distribution (ISO/FW).</p>
</li>
</ul>
<h4 id="noddi-model-fitting">NODDI Model Fitting</h4>
<p><a href="https://github.com/daducci/AMICO">AMICO</a> (Accelerated Microstructure Imaging via Convex Optimization) is used to fit the NODDI model and calculate NODDI-derived metrics, including ICVF, ISOVF, and ODI.</p>
<h4 id="dsi-model-fitting">DSI Model Fitting</h4>
<p>DSIStudio is used to reconstruct the diffusion ODFs and calculate DSI-derived metrics, including GFA, QA etc.</p>
<h3 id="anatomical-processing">Anatomical Processing</h3>
<h4 id="registration-between-dwi-and-anatomiocal-images-fsnative-and-t1w-space">Registration between DWI and anatomiocal Images (fsnative and T1w space)</h4>
<p>While QSIPrep register DWI to T1w space during preprocessing using b0 image, we prefer to use FA map for registration because FA map has better contrast for white matter structures.</p>
<p>If corresponding Freesurfer <code>recon-all</code> results are available, some extra processing will be performed for possible subsequent connectome analysis (see below).</p>
<h3 id="dwi-derived-metrics">DWI-derived Metrics</h3>
<h4 id="psmd">PSMD</h4>
<p>PSMD (Peak Width of Skeletonized Mean Diffusivity), considered a marker of white matter injury, is calculated using <a href="https://github.com/isdneuroimaging/psmd">psmd</a> script <sup id="fnref:zanon2023peak"><a class="footnote-ref" href="#fn:zanon2023peak">3</a></sup>. We use a previous version of the script, while the latest version prefers a Docker-based implementation.</p>
<h4 id="dti-alps">DTI-ALPS</h4>
<p>DTI-ALPS (Diffusion Tensor Image Analysis along the Perivascular Space) is calculated using a customized <a href="https://github.com/gbarisano/alps">script</a>.</p>
<p>The original method was proposed in <sup id="fnref:taoka2017evaluation"><a class="footnote-ref" href="#fn:taoka2017evaluation">4</a></sup>. It is important to note that multiple studies have suggested that DTI-ALPS should not be simply interpreted as a reflection of glymphatic function. Instead, DTI-ALPS likely reflects complex changes in brain microstructure, pointing to a more comprehensive neurodegenerative mechanism <sup id="fnref:li2025microstructural"><a class="footnote-ref" href="#fn:li2025microstructural">5</a></sup>.</p>
<h4 id="pved">PVeD</h4>
<p>periventricular diffusivity (PVeD) is proposed as a substitute marker reflecting the glymphatic function in the brain <sup id="fnref:chen2025periventricular"><a class="footnote-ref" href="#fn:chen2025periventricular">6</a></sup>. It is calculated using the official <a href="https://github.com/ChangleChen/EstPVeD">EstPVeD</a> script.</p>
<p>Things to concern: A region growing method is used to determine the periventricular region. However, if there are lesions (such as lacunar infarcts with high MD values) in this region, these lesion areas will be ignored, leading to variability in the periventricular region among subjects.</p>
<h3 id="connectome-analysis">Connectome Analysis</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>FreeSurfer <code>recon-all</code> results are required for this part of analysis.</p>
</div>
<h4 id="mrtrix3-based-connectome-construction">MRtrix3-based Connectome Construction</h4>
<p>Mrtrix3 is recommended for connectome construction. The main steps are as follows:</p>
<ol>
<li>
<p><code>dwi2response dhollander/tournier</code> to estimate the response functions for different tissue types (for single-shell data, only WM response function is estimated).</p>
</li>
<li>
<p><code>dwi2fod msmt_csd/csd</code> to calculate the fiber orientation distributions (FODs) using constrained spherical deconvolution (CSD) (for multi-shell/single-shell data, respectively).</p>
</li>
<li>
<p><code>mtnormalise</code> to perform multi-tissue informed log-domain intensity normalization on FODs.</p>
</li>
<li>
<p><code>5ttgen freesurfer</code> to generate the 5-tissue-type (5TT) image from Freesurfer <code>recon-all</code> results. That's why Freesurfer results are required for this part of analysis. It is convenient to use Freesurfer parcellation as brain atlas for connectome construction, and outperforms <code>5ttgen fsl</code> in our experience (especially for subjects with severe WMH and Lacunes).</p>
</li>
<li>
<p><code>5tt2gmwmi</code> to generate the gray matter-white matter interface (GM-WM interface) from the 5TT image.</p>
</li>
<li>
<p><code>tckgen</code> to generate 1000000 streamlines using the iFOD2 probabilistic tracking algorithm with anatomically constrained tractography (ACT) framework. The GM-WM interface is used as seeding mask.</p>
</li>
<li>
<p><code>tcksift2</code> to compute the cross-sectional area multipliers for each streamline using SIFT2 method.</p>
</li>
<li>
<p><code>tck2connectome</code> to generate the connectome matrix using Freesurfer parcellation as brain atlas (Currently using aparc and aparc+aseg). The connectome weights are set as SIFT2-weighted streamline count.</p>
</li>
</ol>
<h3 id="references">References</h3>
<div class="footnote">
<hr />
<ol>
<li id="fn:maillard2022mri">
<p>Pauline Maillard, Laura J Hillmer, Hanzhang Lu, Konstantinos Arfanakis, Brian T Gold, Christopher E Bauer, Joel H Kramer, Adam M Staffaroni, Lara Stables, Danny JJ Wang, and others. Mri free water as a biomarker for cognitive performance: validation in the markvcid consortium. <em>Alzheimer's &amp; Dementia: Diagnosis, Assessment &amp; Disease Monitoring</em>, 14(1):e12362, 2022.&#160;<a class="footnote-backref" href="#fnref:maillard2022mri" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:lin2025longitudinal">
<p>Miao Lin, Shuyue Wang, Hui Hong, Yao Zhang, Linyun Xie, Lei Cui, Lingyun Liu, Yeerfan Jiaerken, Xinfeng Yu, Minming Zhang, and others. Longitudinal changes in white matter free water in cerebral small vessel disease: relationship to cerebral blood flow and white matter fiber alterations. <em>Journal of Cerebral Blood Flow &amp; Metabolism</em>, 45(5):932944, 2025.&#160;<a class="footnote-backref" href="#fnref:lin2025longitudinal" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:zanon2023peak">
<p>Maria Clara Zanon Zotin, Pinar Yilmaz, Lukas Sveikata, Dorothee Schoemaker, Susanne J van Veluw, Mark R Etherton, Andreas Charidimou, Steven M Greenberg, Marco Duering, and Anand Viswanathan. Peak width of skeletonized mean diffusivity: a neuroimaging marker for white matter injury. <em>Radiology</em>, 306(3):e212780, 2023.&#160;<a class="footnote-backref" href="#fnref:zanon2023peak" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:taoka2017evaluation">
<p>Toshiaki Taoka, Yoshitaka Masutani, Hisashi Kawai, Toshiki Nakane, Kiwamu Matsuoka, Fumihiko Yasuno, Toshifumi Kishimoto, and Shinji Naganawa. Evaluation of glymphatic system activity with the diffusion mr technique: diffusion tensor image analysis along the perivascular space (dti-alps) in alzheimers disease cases. <em>Japanese journal of radiology</em>, 35(4):172178, 2017.&#160;<a class="footnote-backref" href="#fnref:taoka2017evaluation" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:li2025microstructural">
<p>Sihui Li, Ruike Chen, Zuozhen Cao, Qinfeng Zhu, Yihan Ma, Keqing Zhu, Zixuan Lin, Dan Wu, and Alzheimers Disease Neuroimaging Initiative. Microstructural bias in the assessment of periventricular flow as revealed in postmortem brains. <em>Radiology</em>, 316(3):e250753, 2025.&#160;<a class="footnote-backref" href="#fnref:li2025microstructural" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:chen2025periventricular">
<p>Chang-Le Chen, Sang Joon Son, Noah Schweitzer, Hecheng Jin, Jinghang Li, Linghai Wang, Shaolin Yang, Chang Hyung Hong, Hyun Woong Roh, Bumhee Park, and others. Periventricular diffusivity reflects apoe $\varepsilon $4modulated amyloid accumulation and cognitive impairment in the alzheimer's disease continuum. <em>Alzheimer's &amp; Dementia</em>, 21(9):e70659, 2025.&#160;<a class="footnote-backref" href="#fnref:chen2025periventricular" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>